# 事件循环

## 浏览器的进程模型

- 进程之间是相互隔离的，即使要通信也需要双方同意
- 一个进程至少有一个线程，进程开启时会自动创建一个线程来运行代码，该线程成为主线程（主线程被杀死，所有程序都会停止运行）。如果需要同时执行多块代码，主线程就会启动更多的线程来执行代码，一个进程可能会需要多个线程

### 浏览器有哪些进程和线程

为了防止浏览器连环崩溃，启动浏览器会占用多个内存空间，启动多个进程（如浏览器进程、网络进程、渲染进程）

#### 浏览器进程

- 界面显示
- 用户交互
- 子进程管理

内部会启动多个线程处理不同的任务

#### 网络进程

- 负责加载网络资源

内部会启动多个线程处理不同的任务

#### 渲染进程

- 渲染进程启动后，会开启一个渲染主线程，主线程负责执行html、css、js代码
- 默认情况下会为每个页面创建一个新的渲染进程，以保证不同的标签页之间不会相互影响

### 渲染主线程是如何工作的

主线程需要做得工作

- 解析HTML
- 解析CSS
- 计算样式
- 布局
- 处理图层
- 每秒把页面画60次(fps)
- 执行全局JS代码
- 执行事件处理函数
- 执行计时器的回调函数
- ......

为什么渲染进程不适用多个线程来处理这些事情？

主线程如何调度任务？

答：排队![image-20230221224202792](https://olrando.oss-cn-chengdu.aliyuncs.com/img/image-20230221224202792.png)

### 何为异步

同步可能造成主线程阻塞，导致事件队列里的其他任务无法得到立即执行，导致主线程白白消耗时间，另一方面导致页面无法及时更新，给用户造成卡死现象

异步：js是单线程的语言会立即结束任务的执行，将计时线程里的回调函数包装成任务放在事件队列最后，等到计时结束再执行回调函数

 计时线程

### JS为何会阻碍渲染

JS单线程处理决定了它只能将任务依次完成，如果期间有改变页面的操作，但是前者任务一直没有完成，那么渲染任务将一直无法进行，就会导致JS阻碍渲染问题

### 任务有优先级吗

没有，但是事件队列有优先级

- 同一个类型的任务必须在一个队列，不同的类型的任务可以分属于不同的队列
- 浏览器必须准备好一个微队列，它优先于所有的任务执行 
- 延时队列（中）、交互队列（高）、微队列（最高） 

# 浏览器渲染原理









